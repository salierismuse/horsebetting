<!DOCTYPE html>
<html> 
    <head>
        <title>THE DERBY</title>
        <link rel="stylesheet" href="/style.css">

    </head>

    <body>
        <div class="lane-track">
            <div class="horse" id="horse-<%= horses[0].id %>">H</div>
            </div>
            <div class="lane-track">
            <div class="horse" id="horse-<%= horses[1].id %>">H</div>
            </div>
            <div class="lane-track">
            <div class="horse" id="horse-<%= horses[2].id %>">H</div>
        </div>

        <div class ="dev">
            <form action="/start-race" method="POST">
                <button type="submit">Start Race</button>
            </form>
        </div>

        <div class="timer">
            <h2 id="timer-header">TIME UNTIL NEXT RACE</h2>
            <div id="timer" data-start="<%= raceStartTime %>">Loading...</div>
        </div>

        <div class="bookie">
            <% if (isLoggedIn) { %>
            <h2>Place your bets!</h2>
            <form action="/bet" method="POST">
                <input type="number" name="betAmount" placeholder="Bet amount...">
                <select name="horseId">
                    <option value="<%= horses[0].id %>"><%= horses[0].name %></option>
                    <option value="<%= horses[1].id %>"><%= horses[1].name %></option>
                    <option value="<%= horses[2].id %>"><%= horses[2].name %></option>
                </select>
                <button type="submit">Place Bet</button>
            </form>
            <% } %>
        </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/client.js"></script>

    <script>
    const timerEl = document.getElementById('timer');
    const startTime = parseInt(timerEl.dataset.start);

    function updateTimer() {
        const now = Date.now();
        const diff = startTime - now;

        if (diff <= 0) {
            timerEl.innerText = "RACE IN PROGRESS";
            return;
        }

        // Simple math to get minutes and seconds
        const minutes = Math.floor(diff / 60000);
        const seconds = Math.floor((diff % 60000) / 1000);

        // Add a leading zero if seconds is less than 10 (e.g., 4:05)
        timerEl.innerText = `Next Race: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    // Update immediately, then every second
    updateTimer();
    setInterval(updateTimer, 1000);
    </script>
    </body>

</html>